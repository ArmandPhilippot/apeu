---
import type { HTMLAttributes } from "astro/types";

type Props = Omit<HTMLAttributes<"a">, "href"> & {
  href: string | URL;
  isDownload?: boolean | null | undefined;
  isExternal?: boolean | null | undefined;
};

const {
  class: className,
  isDownload = false,
  isExternal = false,
  rel,
  ...attrs
} = Astro.props;
const linkRel =
  isExternal && !rel?.includes("external") ? `external ${rel}` : rel;
---

{
  /* Unfortunately the `<style />` tag has to be on the same line as the link
   * to avoid an extra space after the link when rendered. */
}
<a
  {...attrs}
  class:list={["link", { download: isDownload }, className]}
  rel={linkRel}><slot /></a
><style>
  .link {
    color: var(--color-primary);
    text-decoration-thickness: 0.2ex;
    text-underline-offset: 0.4ex;
    transition: all 0.18s linear 0s;

    &:where(:hover, :focus) {
      color: var(--color-primary-light);
    }

    &:where(:hover) {
      text-decoration-thickness: 0.4ex;
    }

    &:where(:focus-visible) {
      border-radius: var(--border-radii-sm);
      text-decoration-color: transparent;
      outline: var(--border-size-md) solid var(--color-primary-lighter);
      outline-offset: 0.11ex;
      transition: all 0.1s ease-in-out 0s;
    }

    &:where(:active) {
      color: var(--color-primary-dark);
      text-decoration-thickness: 0.1ex;
    }

    &:where(.download, [hreflang], [rel~="external"]) {
      &::after {
        display: inline-block;
        content: var(--is-lang-hidden, "\0000a0" var(--lang-icon, ""))
          var(--is-icon-hidden, "\0000a0" var(--link-icon, ""));
        font-size: var(--font-size-xs);
      }
    }

    &:where([hreflang]) {
      --lang-icon: "[" attr(hreflang) "]";
    }

    &:where(:not([hreflang])) {
      --is-lang-hidden: "";
    }

    &:where([rel~="external"]:not(.download)) {
      --link-icon: var(--external-icon);
    }

    &:where(.download[rel~="external"]) {
      --link-icon: var(--download-icon) "\0000a0" var(--external-icon);
    }

    &:where(.download:not([rel~="external"])) {
      --link-icon: var(--download-icon);
    }

    &:where(:not(.download):not([rel~="external"])) {
      --is-icon-hidden: "";
    }

    &:has(img) {
      display: block;
      width: fit-content;
      height: fit-content;

      & > :global(img) {
        display: block;
        max-width: 100%;
        height: auto;
      }

      &:where(:hover) {
        border-radius: var(--border-radii-sm);
        outline: var(--border-size-sm) solid var(--color-primary);

        & > :global(img) {
          opacity: 0.95;
          transition: all 0.18s linear 0s;
        }
      }
    }
  }

  :global(:where([data-theme="dark"])) .link {
    &.download {
      --download-icon: url('data:image/svg+xml,<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="14"><path fill="hsl(208, 71%, 80%)" d="m 23.58,36.62016 -11.9469,-12.9234 8.1144,1.7199 V 5.1252 h 7.66584 v 20.29146 l 8.95356,-1.7199 z" /><path fill="hsl(208, 71%, 80%)" d="M 3,31.3794 V 42.8748 H 45 V 31.3794 h -5.05134 v 6.44448 H 8.05134 v -6.4449 z" /></svg>');
    }

    &[rel~="external"] {
      --external-icon: url('data:image/svg+xml,<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="14"><path fill="hsl(208, 71%, 80%)" d="m 45,3 -16.99194,2.47254 8.736,2.73966 -21.47628,21.47628 3.04458,3.04416 21.47544,-21.47544 2.73924,8.73516 z"/><path fill="hsl(208, 71%, 80%)" d="M 4.68,7.2 A 1.68,1.68 0 0 0 3,8.88 V 43.32 A 1.68,1.68 0 0 0 4.68,45 H 39.12 A 1.68,1.68 0 0 0 40.8,43.32 V 29.17188 H 37.44 V 41.64 H 6.36 V 10.56 H 18.82812 V 7.2 Z"/></svg>');
    }
  }

  :global(:where([data-theme="light"])) .link {
    &.download {
      --download-icon: url('data:image/svg+xml,<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="14"><path fill="hsl(208, 52%, 27%)" d="m 23.58,36.62016 -11.9469,-12.9234 8.1144,1.7199 V 5.1252 h 7.66584 v 20.29146 l 8.95356,-1.7199 z" /><path fill="hsl(208, 52%, 27%)" d="M 3,31.3794 V 42.8748 H 45 V 31.3794 h -5.05134 v 6.44448 H 8.05134 v -6.4449 z" /></svg>');
    }

    &[rel~="external"] {
      --external-icon: url('data:image/svg+xml,<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" width="14"><path fill="hsl(208, 52%, 27%)" d="m 45,3 -16.99194,2.47254 8.736,2.73966 -21.47628,21.47628 3.04458,3.04416 21.47544,-21.47544 2.73924,8.73516 z"/><path fill="hsl(208, 52%, 27%)" d="M 4.68,7.2 A 1.68,1.68 0 0 0 3,8.88 V 43.32 A 1.68,1.68 0 0 0 4.68,45 H 39.12 A 1.68,1.68 0 0 0 40.8,43.32 V 29.17188 H 37.44 V 41.64 H 6.36 V 10.56 H 18.82812 V 7.2 Z"/></svg>');
    }
  }
</style>
