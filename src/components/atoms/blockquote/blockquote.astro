---
import type { HTMLAttributes } from "astro/types";

type Props = HTMLAttributes<"figure">;

const { class: className, slot, ...attrs } = Astro.props;
---

<figure {...attrs} class:list={[className, "blockquote"]}>
  <blockquote class="blockquote-quote"><slot /></blockquote>
  {
    Astro.slots.has("caption") ? (
      <figcaption class="blockquote-caption">
        <slot name="caption" />
      </figcaption>
    ) : null
  }
</figure>

<style>
  @layer components {
    .blockquote {
      --bg-offset: calc(var(--one-px-in-rem) * 10);
      --border-offset: calc(var(--bg-offset) + var(--border-size-sm));
      --spread: calc(var(--one-px-in-rem) * -3);
      --border-size-offset: calc(var(--border-size-xl) - var(--spread));

      width: fit-content;
      padding: 0 var(--spacing-md);
      background: var(--color-regular-light);
      border: var(--border-size-sm) solid var(--color-border);
      border-inline-start-color: var(--color-primary);
      border-inline-start-width: var(--border-size-xl);
      border-radius: var(--border-radii-md);
      box-shadow:
        var(--shadow-raised-to-top-left),
        var(--bg-offset) var(--bg-offset) 0 var(--spread)
          var(--color-muted-lighter),
        var(--border-offset) var(--border-offset) 0 var(--spread)
          var(--color-border),
        var(--border-offset) calc(var(--bg-offset) - 1px) 0 var(--spread)
          var(--color-border),
        var(--border-size-offset) var(--border-offset) 0 var(--spread)
          var(--color-muted-darker);
    }

    .blockquote-quote {
      padding: var(--spacing-md) 0;

      &:not(:has(p))::before {
        content: open-quote;
      }

      &:not(:has(p))::after {
        content: close-quote;
      }

      &:has(p) > :global(p:first-child::before) {
        content: open-quote;
      }

      &:has(p) > :global(p:last-child::after) {
        content: close-quote;
      }
    }

    .blockquote-caption {
      padding: var(--spacing-sm) 0;
      border-block-start: var(--border-size-sm) solid var(--color-border);
    }
  }
</style>
